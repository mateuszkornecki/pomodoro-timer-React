<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel='stylesheet' href="/css/main.css">

    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

</head>

<body>



    <div class="root"></div>
    <script type='text/babel'>


             function App(){
                return(
                <div className="App">
                    <TimeboxEditor />
                    <Timebox />
                </div>
                )
            }


            function timeInterval(min, max, value) {
                //It will return a number between min and max
                value = Math.max(min, Math.min(value, max))
                return value;
            }

            function fillWithZeros(targetLength, value) {
                //It will add zeros  before value till value.length = targetLength
                value = value.toString();
                while (value.length < targetLength){
                    value = `0${value}`
                }
                return value;
            }

            function normalizeTime (min, max, targetLength, value) {
               return fillWithZeros(targetLength, timeInterval(min, max, value));
            }

            function Clock({className="", hours, minutes, seconds, miliseconds}) {
                hours = normalizeTime(0, 23, 2, hours);
                minutes = normalizeTime(0, 59, 2, minutes);
                seconds = normalizeTime(0, 59, 2, seconds);
                miliseconds = normalizeTime(0, 999, 3, miliseconds);
            
                return <h2 className={"Clock " + className} > Pozostało {hours}:{minutes}:{seconds}:{miliseconds}</h2>  
            }

            function ProgressBar({className="", percent, trackRemaining}){
                const ProgressBarClasses = trackRemaining === true ? `ProgressBar ProgressBar--reverse ${className}` : `ProgressBar ${className}`;
                const ProgressBarWidth = trackRemaining === true ? `calc(100% - ${percent}%)` : `${percent}%`;
                
                return (
                    <div className={ProgressBarClasses}>
                        <div style={{width: `${ProgressBarWidth}`}}></div>
                    </div>
                )
            }

            function TimeboxEditor(){
                return(
                    <div className="TimeboxEditor inactive">
                        <label htmlFor="taskInput">Co robisz?</label><input id="taskInput" disabled type="text" value="Ucze się skrótów klawiszowych" /><br />
                        <label htmlFor="timeInput">Ile minut?</label><input id="timeInput" disabled type="number" value="25" /><br />
                        <button disabled>Zacznij</button>
                     </div>
                )
            }       

            class Timebox extends React.Component {
                constructor(props) {
                    super(props);
                    this.state ={
                        isRunning: true,
                        isPaused: false,
                        pausesCount:0,
                    }
                    this.handleStart = this.handleStart.bind(this)
                    this.handleStop = this.handleStop.bind(this)
                    this.togglePause = this.togglePause.bind(this)
                }
               handleStart() {
                    this.setState({
                        isRunning: true
                    })
                }
                handleStop() {
                    this.setState({
                        isRunning: false,
                        isPaused: false,
                        pausesCount:0
                    })
                }

                togglePause() {
                    this.setState(
                        function(prevState){
                            //? WTF?? - dlaczego to działa w sensie skąd wiadomo że isPaused = isPaused?
                            //TODO do ogarnięcia
                            const isPaused = !prevState.isPaused
                            return{
                                isPaused: isPaused,
                                pausesCount: prevState.isPaused ? prevState.pausesCount + 1 : prevState.pausesCount
                                
                            }
                        }
                    )
                }

                render() {
                    const  {isRunning, isPaused, pausesCount} = this.state;
                    return(
                        <div className="Timebox">
                            <h1>Ucze się skrótów klawiszowych</h1>
                            <Clock className={ isPaused ? "inactive" : ""} hours={26} minutes={63} seconds={98} miliseconds={1000}/> 
                            <ProgressBar className={ isPaused ? "inactive" : ""} percent={25} trackRemaining={false} />
                            <button onClick={this.handleStart} disabled={isRunning}>Start</button>
                            <button onClick={this.handleStop} disabled={!isRunning}>Stop</button>
                            <button onClick={this.togglePause} disabled={!isRunning}>{isPaused ? 'Wznów' : 'Pauzuj'}</button>
                            Liczba przerw: {pausesCount}
                        </div>
                    )
                }
            }

                ReactDOM.render(<App />, document.querySelector('.root'));


        </script>
</body>

</html>